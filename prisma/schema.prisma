generator client {
  provider = "prisma-client-js"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model UserSession {
  id           String   @id @default(cuid())
  sessionToken String   @unique
  user_id      String
  user         User     @relation(fields: [user_id], references: [id], onDelete: Cascade)
  expires      DateTime
  createdAt    DateTime @default(now())

  @@index([user_id])
}

model User {
  id           String        @id @default(cuid())
  name         String        @unique
  country      String
  institution  String?
  studentId    String?
  major        String?
  dateOfBirth  DateTime?
  gender       String?
  id_card      String?
  phone_number String
  email        String        @unique
  line_id      String
  password     String
  poster_url   String
  twibbon_url  String
  proposal_url String?
  role         Role          @default(USER)
  teamId       String?
  team         Team?         @relation(fields: [teamId], references: [id])
  userSession  UserSession[]

  discussions Discussion[]
  replies     Reply[]
}

model Team {
  id            String       @id @default(cuid())
  name          String       @unique
  category      TeamCategory
  phone         String
  line_id       String
  payment_proof String?
  status        TeamStatus   @default(PENDING)

  submission_originality_url String?
  submission_proposal_url    String?
  submission_lean_canvas_url String?
  submission_figma_url       String?
  submission_gdrive_url      String?

  submission_ppt_url        String?
  submission_github_url     String?
  submission_video_demo_url String?

  isFinalist Boolean @default(false)

  members   User[]
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

enum TeamCategory {
  UIUX
  HACKATON
}

enum TeamStatus {
  PENDING
  REJECTED
  ACCEPTED
}

enum Role {
  ADMIN
  USER
}

// Discussion for QNA
model Discussion {
  id       String @id @default(cuid())
  title    String @db.Text
  question String @db.Text
  authorId String

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  author  User    @relation(fields: [authorId], references: [id], onDelete: Cascade)
  replies Reply[]
}

model Reply {
  id           String @id @default(cuid())
  content      String @db.Text
  authorId     String
  discussionId String

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  author     User       @relation(fields: [authorId], references: [id], onDelete: Cascade)
  discussion Discussion @relation(fields: [discussionId], references: [id], onDelete: Cascade)
}
